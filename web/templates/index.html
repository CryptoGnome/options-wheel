<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WheelForge Trading Dashboard</title>
    
    <!-- Modern UI Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.0.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modern-dashboard.css') }}">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <!-- Socket.io -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <!-- ApexCharts for advanced visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-left">
                <div class="logo">
                    <i class="ri-steering-2-fill"></i>
                    <span>WheelForge</span>
                </div>
                <div class="market-status" id="marketStatus">
                    <span class="status-indicator"></span>
                    <span class="status-text">Connecting...</span>
                </div>
            </div>
            
            <div class="navbar-center">
                <div class="nav-tabs">
                    <button class="nav-tab active" data-section="overview">
                        <i class="ri-dashboard-3-line"></i>
                        <span>Overview</span>
                    </button>
                    <button class="nav-tab" data-section="positions">
                        <i class="ri-briefcase-line"></i>
                        <span>Positions</span>
                    </button>
                    <button class="nav-tab" data-section="analytics">
                        <i class="ri-bar-chart-box-line"></i>
                        <span>Analytics</span>
                    </button>
                    <button class="nav-tab" data-section="config">
                        <i class="ri-settings-3-line"></i>
                        <span>Config</span>
                    </button>
                </div>
            </div>
            
            <div class="navbar-right">
                <div class="trading-mode" id="tradingMode">
                    <i class="ri-test-tube-line"></i>
                    <span>PAPER</span>
                </div>
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                    <i class="ri-sun-line" id="themeIcon"></i>
                </button>
                <button class="strategy-control" id="strategyControl">
                    <i class="ri-play-circle-line"></i>
                    <span>Start Strategy</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Dashboard Container -->
    <main class="dashboard-container">
        
        <!-- Overview Section -->
        <section class="dashboard-section active" id="overview-section">
            <!-- Key Metrics Row -->
            <div class="metrics-row">
                <div class="metric-card primary">
                    <div class="metric-header">
                        <span class="metric-label">Portfolio Value</span>
                        <i class="ri-wallet-3-line"></i>
                    </div>
                    <div class="metric-value" id="portfolioValue">$0.00</div>
                    <div class="metric-change" id="portfolioChange">
                        <span>0.00%</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-label">Total P&L</span>
                        <i class="ri-line-chart-line"></i>
                    </div>
                    <div class="metric-value" id="totalPnL">$0.00</div>
                    <div class="metric-subtext">
                        <span>Daily: </span>
                        <span id="dailyPnL">$0.00</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-label">Premium Income</span>
                        <i class="ri-money-dollar-circle-line"></i>
                    </div>
                    <div class="metric-value" id="totalPremiums">$0.00</div>
                    <div class="metric-subtext">
                        <span>This Month: </span>
                        <span id="monthlyPremiums">$0.00</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-label">Win Rate</span>
                        <i class="ri-trophy-line"></i>
                    </div>
                    <div class="metric-value" id="winRate">0%</div>
                    <div class="metric-subtext">
                        <span id="totalTrades">0</span>
                        <span> trades</span>
                    </div>
                </div>
            </div>

            <!-- Active Wheels Grid -->
            <div class="content-grid">
                <div class="card">
                    <div class="card-header">
                        <h3>Active Wheels</h3>
                        <button class="btn-icon" id="refreshWheels">
                            <i class="ri-refresh-line"></i>
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="wheels-grid" id="wheelsGrid">
                            <!-- Wheel cards will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Live Orders -->
                <div class="card">
                    <div class="card-header">
                        <h3>Pending Orders</h3>
                        <div class="badge" id="pendingCount">0</div>
                    </div>
                    <div class="card-body">
                        <div class="orders-list" id="ordersList">
                            <div class="empty-state">
                                <i class="ri-time-line"></i>
                                <p>No pending orders</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Chart -->
            <div class="card chart-card">
                <div class="card-header">
                    <h3>Performance Overview</h3>
                    <div class="chart-controls">
                        <button class="chart-period active" data-period="1W">1W</button>
                        <button class="chart-period" data-period="1M">1M</button>
                        <button class="chart-period" data-period="3M">3M</button>
                        <button class="chart-period" data-period="YTD">YTD</button>
                        <button class="chart-period" data-period="ALL">ALL</button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="performanceChart"></div>
                </div>
            </div>
        </section>

        <!-- Positions Section -->
        <section class="dashboard-section" id="positions-section">
            <div class="positions-header">
                <div class="positions-tabs">
                    <button class="position-tab active" data-type="options">
                        <i class="ri-file-list-3-line"></i>
                        Options
                        <span class="tab-count" id="optionsCount">0</span>
                    </button>
                    <button class="position-tab" data-type="stocks">
                        <i class="ri-stock-line"></i>
                        Stocks
                        <span class="tab-count" id="stocksCount">0</span>
                    </button>
                </div>
                <div class="positions-actions">
                    <button class="btn-secondary" id="exportPositions">
                        <i class="ri-download-2-line"></i>
                        Export
                    </button>
                </div>
            </div>

            <!-- Options Positions Table -->
            <div class="card position-table-card active" id="optionsTable">
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Type</th>
                                <th>Strike</th>
                                <th>Expiration</th>
                                <th>DTE</th>
                                <th>Quantity</th>
                                <th>Entry</th>
                                <th>Current</th>
                                <th>P&L</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="optionsTableBody">
                            <!-- Rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Stock Positions Table -->
            <div class="card position-table-card" id="stocksTable">
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Shares</th>
                                <th>Avg Cost</th>
                                <th>Current Price</th>
                                <th>Market Value</th>
                                <th>P&L</th>
                                <th>P&L %</th>
                                <th>State</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="stocksTableBody">
                            <!-- Rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Analytics Section -->
        <section class="dashboard-section" id="analytics-section">
            <!-- Analytics Grid -->
            <div class="analytics-grid">
                <!-- P&L Breakdown -->
                <div class="card">
                    <div class="card-header">
                        <h3>P&L Breakdown</h3>
                    </div>
                    <div class="card-body">
                        <div id="pnlBreakdownChart"></div>
                    </div>
                </div>

                <!-- Symbol Performance -->
                <div class="card">
                    <div class="card-header">
                        <h3>Symbol Performance</h3>
                    </div>
                    <div class="card-body">
                        <div id="symbolPerformanceChart"></div>
                    </div>
                </div>

                <!-- Monthly Income -->
                <div class="card">
                    <div class="card-header">
                        <h3>Monthly Income</h3>
                    </div>
                    <div class="card-body">
                        <div id="monthlyIncomeChart"></div>
                    </div>
                </div>

                <!-- Strategy Statistics -->
                <div class="card">
                    <div class="card-header">
                        <h3>Strategy Statistics</h3>
                    </div>
                    <div class="card-body">
                        <div class="stats-list">
                            <div class="stat-item">
                                <span class="stat-label">Average Premium</span>
                                <span class="stat-value" id="avgPremium">$0.00</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Put/Call Ratio</span>
                                <span class="stat-value" id="putCallRatio">0:0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Avg Days to Expiry</span>
                                <span class="stat-value" id="avgDTE">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Assignment Rate</span>
                                <span class="stat-value" id="assignmentRate">0%</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Roll Success Rate</span>
                                <span class="stat-value" id="rollRate">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Performance Table -->
            <div class="card">
                <div class="card-header">
                    <h3>Detailed Performance by Symbol</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Total P&L</th>
                                    <th>Put Income</th>
                                    <th>Call Income</th>
                                    <th>Total Trades</th>
                                    <th>Win Rate</th>
                                    <th>Avg Premium</th>
                                    <th>ROI</th>
                                </tr>
                            </thead>
                            <tbody id="performanceTableBody">
                                <!-- Rows will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Configuration Section -->
        <section class="dashboard-section" id="config-section">
            <div class="config-container">
                <!-- Strategy Settings -->
                <div class="card">
                    <div class="card-header">
                        <h3>Strategy Settings</h3>
                        <button class="btn-primary" id="saveConfig">
                            <i class="ri-save-line"></i>
                            Save Changes
                        </button>
                    </div>
                    <div class="card-body">
                        <form id="configForm">
                            <div class="form-section">
                                <h4>Balance Management</h4>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="allocationPercentage">
                                            Allocation Percentage
                                            <span class="tooltip">
                                                <i class="ri-information-line"></i>
                                                <span class="tooltip-text">Percentage of non-margin balance to use</span>
                                            </span>
                                        </label>
                                        <div class="input-group">
                                            <input type="range" id="allocationRange" min="0" max="100" step="1">
                                            <input type="number" id="allocationPercentage" min="0" max="100" step="1">
                                            <span class="input-suffix">%</span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="maxWheelLayers">
                                            Max Wheel Layers
                                            <span class="tooltip">
                                                <i class="ri-information-line"></i>
                                                <span class="tooltip-text">Maximum number of wheel cycles per symbol</span>
                                            </span>
                                        </label>
                                        <input type="number" id="maxWheelLayers" min="1" max="5" step="1">
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h4>Option Filters</h4>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label>Delta Range</label>
                                        <div class="range-inputs">
                                            <input type="number" id="deltaMin" step="0.01" placeholder="Min">
                                            <span>to</span>
                                            <input type="number" id="deltaMax" step="0.01" placeholder="Max">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Days to Expiry</label>
                                        <div class="range-inputs">
                                            <input type="number" id="dteMin" min="0" placeholder="Min">
                                            <span>to</span>
                                            <input type="number" id="dteMax" min="0" placeholder="Max">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Yield Range</label>
                                        <div class="range-inputs">
                                            <input type="number" id="yieldMin" step="0.01" placeholder="Min">
                                            <span>to</span>
                                            <input type="number" id="yieldMax" step="0.01" placeholder="Max">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="openInterestMin">Min Open Interest</label>
                                        <input type="number" id="openInterestMin" min="0" step="10">
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h4>Rolling Settings</h4>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="switch-label">
                                            <input type="checkbox" id="rollingEnabled" class="switch-input">
                                            <span class="switch-slider"></span>
                                            <span>Enable Rolling</span>
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label for="daysBeforeExpiry">Days Before Expiry</label>
                                        <input type="number" id="daysBeforeExpiry" min="0" max="7">
                                    </div>
                                    <div class="form-group">
                                        <label for="minPremiumToRoll">Min Premium to Roll</label>
                                        <input type="number" id="minPremiumToRoll" step="0.01">
                                    </div>
                                    <div class="form-group">
                                        <label for="rollDeltaTarget">Roll Delta Target</label>
                                        <input type="number" id="rollDeltaTarget" step="0.01">
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Symbol Management -->
                <div class="card">
                    <div class="card-header">
                        <h3>Symbol Management</h3>
                        <button class="btn-secondary" id="addSymbol">
                            <i class="ri-add-line"></i>
                            Add Symbol
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="symbols-grid" id="symbolsGrid">
                            <!-- Symbol cards will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Backend Logs Section -->
        <section class="dashboard-section">
            <div class="section-header">
                <h2><i class="ri-terminal-line"></i> Live Strategy Logs</h2>
                <div class="section-actions">
                    <button class="btn-icon" id="clearMainLogs" title="Clear logs">
                        <i class="ri-delete-bin-line"></i>
                    </button>
                    <button class="btn-icon active" id="toggleMainAutoScroll" title="Auto-scroll">
                        <i class="ri-arrow-down-line"></i>
                    </button>
                </div>
            </div>
            <div class="log-main-container">
                <div class="log-main-filters">
                    <button class="log-filter active" data-level="all">All</button>
                    <button class="log-filter" data-level="info">Info</button>
                    <button class="log-filter" data-level="warning">Warning</button>
                    <button class="log-filter" data-level="error">Error</button>
                    <button class="log-filter" data-level="success">Success</button>
                </div>
                <div class="log-main-content" id="mainLogContent">
                    <div class="log-welcome">
                        <i class="ri-terminal-box-line"></i>
                        <p>Strategy logs will appear here when running...</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modals -->
    <!-- Add Symbol Modal -->
    <div class="modal" id="addSymbolModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Symbol</h3>
                <button class="modal-close" data-modal="addSymbolModal">
                    <i class="ri-close-line"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addSymbolForm">
                    <div class="form-group">
                        <label for="newSymbol">Symbol</label>
                        <input type="text" id="newSymbol" placeholder="e.g., AAPL" required>
                    </div>
                    <div class="form-group">
                        <label for="newSymbolContracts">Contracts</label>
                        <input type="number" id="newSymbolContracts" min="1" value="1" required>
                    </div>
                    <div class="form-group">
                        <label class="switch-label">
                            <input type="checkbox" id="newSymbolEnabled" class="switch-input" checked>
                            <span class="switch-slider"></span>
                            <span>Enabled</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" data-modal="addSymbolModal">Cancel</button>
                <button class="btn-primary" id="confirmAddSymbol">Add Symbol</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Real-time Log Viewer -->
    <div class="log-viewer" id="logViewer">
        <div class="log-container">
            <div class="log-header">
                <h3><i class="ri-terminal-line"></i> Strategy Logs</h3>
                <div class="log-controls">
                    <button class="btn-icon" id="clearLogs" title="Clear logs">
                        <i class="ri-delete-bin-line"></i>
                    </button>
                    <button class="btn-icon" id="toggleAutoScroll" title="Auto-scroll">
                        <i class="ri-arrow-down-line"></i>
                    </button>
                    <button class="btn-icon" id="minimizeLogs" title="Minimize">
                        <i class="ri-subtract-line"></i>
                    </button>
                    <button class="btn-icon" id="closeLogs" title="Close">
                        <i class="ri-close-line"></i>
                    </button>
                </div>
            </div>
            <div class="log-filters">
                <button class="log-filter active" data-level="all">All</button>
                <button class="log-filter" data-level="info">Info</button>
                <button class="log-filter" data-level="warning">Warning</button>
                <button class="log-filter" data-level="error">Error</button>
                <button class="log-filter" data-level="success">Success</button>
            </div>
            <div class="log-content" id="logContent">
                <div class="log-welcome">
                    <i class="ri-terminal-box-line"></i>
                    <p>Strategy logs will appear here when running...</p>
                </div>
            </div>
            <div class="log-status-bar">
                <span class="log-count">0 logs</span>
                <span class="log-connection">
                    <i class="ri-wifi-line"></i>
                    Connected
                </span>
            </div>
        </div>
    </div>

    <!-- Minimized Log Badge -->
    <div class="log-badge" id="logBadge">
        <i class="ri-terminal-line"></i>
        <span class="badge-count">0</span>
    </div>

    <!-- First-Time Setup Wizard -->
    <div class="setup-wizard" id="setupWizard">
        <div class="setup-container">
            <div class="setup-header">
                <div class="setup-logo">
                    <i class="ri-steering-2-fill"></i>
                    <h1>Welcome to WheelForge</h1>
                </div>
                <p class="setup-subtitle">Let's get your options wheel strategy up and running in just a few steps</p>
            </div>

            <div class="setup-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="setupProgress"></div>
                </div>
                <div class="progress-steps">
                    <div class="step active" data-step="1">
                        <div class="step-number">1</div>
                        <span>API Keys</span>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-number">2</div>
                        <span>Risk Settings</span>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-number">3</div>
                        <span>Symbols</span>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-number">4</div>
                        <span>Review</span>
                    </div>
                </div>
            </div>

            <div class="setup-content">
                <!-- Step 1: API Configuration -->
                <div class="setup-step active" id="step1">
                    <h2>Connect to Alpaca</h2>
                    <p class="step-description">First, we need your Alpaca API credentials. You can get these from your Alpaca dashboard.</p>
                    
                    <div class="setup-form">
                        <div class="form-group">
                            <label for="setupApiKey">
                                <i class="ri-key-2-line"></i>
                                API Key
                                <span class="required">*</span>
                            </label>
                            <input type="text" id="setupApiKey" placeholder="PKxxxxxxxxxxxxx" required>
                            <small>Found in your Alpaca dashboard under API Keys</small>
                        </div>

                        <div class="form-group">
                            <label for="setupSecretKey">
                                <i class="ri-lock-password-line"></i>
                                Secret Key
                                <span class="required">*</span>
                            </label>
                            <input type="password" id="setupSecretKey" placeholder="Your secret key" required>
                            <small>Keep this secure - it won't be shown again</small>
                        </div>

                        <div class="form-group">
                            <label class="radio-group">
                                <i class="ri-shield-check-line"></i>
                                Trading Mode
                            </label>
                            <div class="radio-options">
                                <label class="radio-option">
                                    <input type="radio" name="tradingMode" value="true" checked>
                                    <div class="radio-card recommended">
                                        <i class="ri-test-tube-line"></i>
                                        <span class="radio-title">Paper Trading</span>
                                        <span class="radio-desc">Test with virtual money first</span>
                                        <span class="badge-recommended">Recommended</span>
                                    </div>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="tradingMode" value="false">
                                    <div class="radio-card">
                                        <i class="ri-money-dollar-circle-line"></i>
                                        <span class="radio-title">Live Trading</span>
                                        <span class="radio-desc">Trade with real money</span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <i class="ri-information-line"></i>
                            <div>
                                <strong>New to Alpaca?</strong>
                                <a href="https://app.alpaca.markets/signup" target="_blank">Sign up for free</a> and get instant access to paper trading.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Risk Management -->
                <div class="setup-step" id="step2">
                    <h2>Risk Management Settings</h2>
                    <p class="step-description">Configure how much capital to allocate and your risk parameters.</p>
                    
                    <div class="setup-form">
                        <div class="form-group">
                            <label for="setupAllocation">
                                <i class="ri-percent-line"></i>
                                Capital Allocation
                                <span class="tooltip">
                                    <i class="ri-information-line"></i>
                                    <span class="tooltip-text">Percentage of your account to use for the wheel strategy</span>
                                </span>
                            </label>
                            <div class="slider-group">
                                <input type="range" id="setupAllocationSlider" min="10" max="100" value="30" step="5">
                                <div class="slider-value">
                                    <input type="number" id="setupAllocation" min="10" max="100" value="30">
                                    <span>%</span>
                                </div>
                            </div>
                            <small>Start conservative - you can always increase this later</small>
                        </div>

                        <div class="form-group">
                            <label for="setupWheelLayers">
                                <i class="ri-stack-line"></i>
                                Max Wheel Layers
                                <span class="tooltip">
                                    <i class="ri-information-line"></i>
                                    <span class="tooltip-text">Number of concurrent wheel cycles per symbol for averaging down</span>
                                </span>
                            </label>
                            <select id="setupWheelLayers">
                                <option value="1">1 Layer - Single position per symbol</option>
                                <option value="2" selected>2 Layers - Allow averaging down once</option>
                                <option value="3">3 Layers - More aggressive positioning</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>
                                <i class="ri-line-chart-line"></i>
                                Delta Range
                                <span class="tooltip">
                                    <i class="ri-information-line"></i>
                                    <span class="tooltip-text">Probability of assignment - lower delta = lower risk</span>
                                </span>
                            </label>
                            <div class="range-input-group">
                                <input type="number" id="setupDeltaMin" value="0.15" step="0.05" min="0.05" max="0.5">
                                <span>to</span>
                                <input type="number" id="setupDeltaMax" value="0.30" step="0.05" min="0.1" max="0.5">
                            </div>
                            <small>0.15-0.30 is conservative, 0.30-0.45 is aggressive</small>
                        </div>

                        <div class="form-group">
                            <label>
                                <i class="ri-calendar-line"></i>
                                Days to Expiry Range
                            </label>
                            <div class="range-input-group">
                                <input type="number" id="setupDTEMin" value="0" min="0" max="45">
                                <span>to</span>
                                <input type="number" id="setupDTEMax" value="21" min="7" max="60">
                            </div>
                            <small>Shorter DTE = higher premium/time but more management</small>
                        </div>

                        <div class="alert alert-warning">
                            <i class="ri-alert-line"></i>
                            <div>
                                <strong>Risk Notice:</strong>
                                Start with conservative settings. You can always adjust after seeing how the strategy performs.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Symbol Selection -->
                <div class="setup-step" id="step3">
                    <h2>Select Symbols to Trade</h2>
                    <p class="step-description">Choose which stocks you want to run the wheel strategy on.</p>
                    
                    <div class="setup-form">
                        <div class="symbol-quick-add">
                            <h3>Popular Wheel Symbols</h3>
                            <div class="symbol-suggestions">
                                <button class="symbol-chip" data-symbol="SPY" data-contracts="1">
                                    <span>SPY</span>
                                    <small>S&P 500 ETF</small>
                                </button>
                                <button class="symbol-chip" data-symbol="QQQ" data-contracts="1">
                                    <span>QQQ</span>
                                    <small>Nasdaq ETF</small>
                                </button>
                                <button class="symbol-chip" data-symbol="AAPL" data-contracts="1">
                                    <span>AAPL</span>
                                    <small>Apple</small>
                                </button>
                                <button class="symbol-chip" data-symbol="MSFT" data-contracts="1">
                                    <span>MSFT</span>
                                    <small>Microsoft</small>
                                </button>
                                <button class="symbol-chip" data-symbol="TSLA" data-contracts="1">
                                    <span>TSLA</span>
                                    <small>Tesla</small>
                                </button>
                                <button class="symbol-chip" data-symbol="AMD" data-contracts="1">
                                    <span>AMD</span>
                                    <small>AMD</small>
                                </button>
                                <button class="symbol-chip" data-symbol="NVDA" data-contracts="1">
                                    <span>NVDA</span>
                                    <small>Nvidia</small>
                                </button>
                            </div>
                        </div>

                        <div class="custom-symbol-add">
                            <h3>Add Custom Symbol</h3>
                            <div class="input-group">
                                <input type="text" id="setupCustomSymbol" placeholder="Enter symbol (e.g., AMZN)">
                                <input type="number" id="setupCustomContracts" value="1" min="1" max="10">
                                <button class="btn-add" id="addCustomSymbol">
                                    <i class="ri-add-line"></i>
                                    Add
                                </button>
                            </div>
                        </div>

                        <div class="selected-symbols">
                            <h3>Selected Symbols</h3>
                            <div id="selectedSymbolsList" class="symbols-list">
                                <div class="empty-state">
                                    <i class="ri-stock-line"></i>
                                    <p>No symbols selected yet</p>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <i class="ri-information-line"></i>
                            <div>
                                <strong>Symbol Selection Tips:</strong>
                                <ul>
                                    <li>Start with 2-3 liquid symbols you understand</li>
                                    <li>ETFs like SPY and QQQ are good for beginners</li>
                                    <li>Ensure symbols have good options volume</li>
                                    <li>Each contract = 100 shares commitment</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Review & Launch -->
                <div class="setup-step" id="step4">
                    <h2>Review Your Configuration</h2>
                    <p class="step-description">Double-check your settings before starting.</p>
                    
                    <div class="setup-review">
                        <div class="review-section">
                            <h3><i class="ri-key-2-line"></i> API Configuration</h3>
                            <div class="review-items">
                                <div class="review-item">
                                    <span>API Key:</span>
                                    <strong id="reviewApiKey">PKxxx...xxx</strong>
                                </div>
                                <div class="review-item">
                                    <span>Mode:</span>
                                    <strong id="reviewMode">Paper Trading</strong>
                                </div>
                            </div>
                        </div>

                        <div class="review-section">
                            <h3><i class="ri-shield-line"></i> Risk Settings</h3>
                            <div class="review-items">
                                <div class="review-item">
                                    <span>Capital Allocation:</span>
                                    <strong id="reviewAllocation">30%</strong>
                                </div>
                                <div class="review-item">
                                    <span>Max Wheel Layers:</span>
                                    <strong id="reviewLayers">2</strong>
                                </div>
                                <div class="review-item">
                                    <span>Delta Range:</span>
                                    <strong id="reviewDelta">0.15 - 0.30</strong>
                                </div>
                                <div class="review-item">
                                    <span>DTE Range:</span>
                                    <strong id="reviewDTE">0 - 21 days</strong>
                                </div>
                            </div>
                        </div>

                        <div class="review-section">
                            <h3><i class="ri-stock-line"></i> Selected Symbols</h3>
                            <div class="review-symbols" id="reviewSymbols">
                                <!-- Symbols will be listed here -->
                            </div>
                        </div>

                        <div class="alert alert-success">
                            <i class="ri-check-line"></i>
                            <div>
                                <strong>Ready to go!</strong>
                                Your configuration will be saved and you can start trading immediately.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="setup-footer">
                <button class="btn-secondary" id="setupBack" style="display: none;">
                    <i class="ri-arrow-left-line"></i>
                    Back
                </button>
                <button class="btn-primary" id="setupNext">
                    Next
                    <i class="ri-arrow-right-line"></i>
                </button>
                <button class="btn-success" id="setupComplete" style="display: none;">
                    <i class="ri-rocket-line"></i>
                    Launch WheelForge
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
    <script src="{{ url_for('static', filename='js/setup-wizard.js') }}"></script>
    <script src="{{ url_for('static', filename='js/modern-dashboard.js') }}"></script>
</body>
</html>